<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <meta name="description" contents="Real-time Multiplayer 3D Social Web Spaces Network">

    <title>(home v3.1)</title>

    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/bootbox-dialoges.css">
    <link rel="stylesheet" href="/css/side-panels.css">
    <link rel="stylesheet" href="/css/messg.css" >
    <link rel="stylesheet" href="/css/spectrum.css">
    <link rel="stylesheet" href="/css/colorpicker.css">
    <link rel="stylesheet" href="/css/spinner.css">
    <link rel="stylesheet" href="/css/jquery-ui.css">
    <link rel="stylesheet" href="/css/alerts.css">
    <link rel="stylesheet" href="/css/panel-ui.css">
    <link rel="stylesheet" href="/css/anywhere3d.css">
    <link rel="stylesheet" href="/css/jquery.Jcrop.css">
    <link rel="stylesheet" href="/css/menu-menubar.css">
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/style.css">

    <script src="/socketcluster.js"></script>
    <script src="/sc-codec-min-bin.js"></script>

    <script>
        var debugMode = true;
    </script>

</head>

<body>

<style>

    #content div ul li {
        cursor: pointer;
        margin-left:15px;
    }

    #right-side-content {
        position:absolute; left:25px; top:60px; right:10px; bottom:40px; 
        padding: 0px 20px 0px 20px; overflow:auto; 
    }

    a.none-deco:focus,
    a.none-deco:hover, 
    a.none-deco:active, 
    a.none-deco:visited {
        color:#55a5ec;
        text-decoration:none;
    }

</style>

<div id="panel" class="collapsed">
    <h1><a href="/" class="none-deco">Sloothes</a></h1>
    <a id="expandButton" href="#">
        <span></span>
        <span></span>
        <span></span>
    </a>
    <div class="filterBlock" >
        <input type="text" id="filterInput" placeholder="Type to filter"/>
        <a href="#" id="clearFilterButton" >x</a>
    </div>
    <div id="content"></div>
</div>

<section class="mbr-section" id="body-section">

    <iframe id="viewer" src="/scene/"></iframe>

    <div class="side-panel" id="right-side" style="top:0;">
        <div id="right-side-pinbtn" title="click this to pin/unpin panel"></div>

        <div id="right-side-content" style="overflow-x:hidden;">

            <div class="side-holder" style="margin-bottom:20px;">
                <ul class="nav nav-tabs nav-pills" style="overflow-x:auto;overflow-y:hidden;width:300px;">

                    <li class role="presentation"><a href="#control-tab" data-toggle="pill" class="pills right-pill right-pill-control">Control</a></li>
                    <li class role="presentation"><a href="#outfits-tab" data-toggle="pill" class="pills right-pill right-pill-outfits">Outfit</a></li>
                    <li class role="presentation"><a href="#login-tab" data-toggle="pill" class="pills right-pill right-pill-login">Login</a></li>

                </ul>
            </div>

            <div id="right-side-panel" class="tab-content">

                <div id="control-tab" class="component-pane tab-pane fade in active"></div>
                <div id="outfits-tab" class="component-pane tab-pane fade"></div>
                <div id="new-product-tab" class="component-pane tab-pane fade"></div>
                <div id="edit-product-tab" class="component-pane tab-pane fade"></div>
                <div id="buy-product-tab" class="component-pane tab-pane fade"></div>
                <div id="helpers-tab" class="component-pane tab-pane fade"></div>
                <div id="login-tab" class="component-pane tab-pane fade"></div>

            </div>

        </div>

    </div>

    <div class="middle" id="dialog-panel">
        <div id="dialog-container" style="max-width:350px;max-height:600px;"></div>
    </div>

</section>

<script src="/home/menu-list.js"></script>
<script src="/home/menu-panel.js"></script>
<script src="/js/w3.js"></script>
<script src="/js/rawinflate.js"></script>
<script src="/js/rawdeflate.js"></script>
<script src="/js/store2.js"></script>
<script src="/js/Objectid.js"></script>
<script src="/js/zangodb.min.js"></script>
<script src="/js/jquery.min.js"></script>
<script src="/js/jquery-ui.js"></script>
<script src="/js/jquery.Jcrop.js"></script>
<script src="/js/bootbox.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/DeviceDetector.js"></script>
<script src="/js/MathDecimalAdjustment.js"></script>
<script src="/js/watermark.js"></script>
<script src="/js/validator.js"></script>
<script src="/js/system.min.js"></script>
<script src="/js/signals.min.js"></script>
<script src="/js/command.js"></script>
<script src="/js/spectrum.js"></script>
<script src="/js/validator.min.js"></script>
<script src="/js/alerts.js"></script>
<script src="/js/side-panels.js"></script>

<script>

//  Port to scene window.

    var viewer = document.getElementById( "viewer" );
    var SceneWindow = viewer.contentWindow; // important!
    var SceneDocument = viewer.contentDocument; // important!

    $(viewer.contentWindow).on("load", function(){
        db = this.db;
        MW = this.MW;
        THREE = this.THREE;
        scene = this.scene;
        camera = this.camera;
        renderer = this.renderer;
        localPlayer = this.localPlayer;
        cameraControls = this.cameraControls;
        keyInputControls = this.keyInputControls;
    });

</script>

<script>

(function(){

    var interval, msec = 250;
    const Signal = signals.Signal;

    const Run   = nameCategoryMap["Run"];
    const Idle  = nameCategoryMap["Idle"];
    const Walk  = nameCategoryMap["Walk"];
    const Jump  = nameCategoryMap["Jump"];
    const Left  = nameCategoryMap["Left"];
    const Back  = nameCategoryMap["Back"];
    const Right = nameCategoryMap["Right"];
    const Front = nameCategoryMap["Front"];

    const Male = nameCategoryMap["Male"];
    const Female = nameCategoryMap["Female"];
    const Hairs = nameCategoryMap["Hairs"];
    const Stockings = nameCategoryMap["Stockings"];
    const Underwears = nameCategoryMap["Underwears"];
    const Dress = nameCategoryMap["Dress"];
    const Costume = nameCategoryMap["Costume"];
    const Tshirt = nameCategoryMap["Tshirt"];
    const Trousers = nameCategoryMap["Trousers"];
    const Shoes = nameCategoryMap["Shoes"];

    var actionClicked = new Signal();
    var menuItemClicked = new Signal();

    function isWalking(){
        return viewer.contentWindow.localPlayer.controller.isRunning && viewer.contentWindow.localPlayer.controller.isWalking; // danger!
    }

    function isRunning(){
        return viewer.contentWindow.localPlayer.controller.isRunning && !viewer.contentWindow.localPlayer.controller.isWalking; // danger!
    }

    function dispatchIdleAction(){
        actionClicked.dispatch("/action/idle");
    }

    function dispatchWalkAction(){
        if ( isWalking() ) 
            actionClicked.dispatch("/action/idle");
        else 
            actionClicked.dispatch("/action/walk");
    }

    function dispatchRunAction(){
        if ( isRunning() ) 
            actionClicked.dispatch("/action/idle");
        else 
            actionClicked.dispatch("/action/run");
    }

    function dispatchJumpAction(){
        $(Jump.element).off("click");
        actionClicked.dispatch("/action/jump");
    }

    $(viewer.contentWindow).on("load", function(){
        this.localPlayer.controller.addEventListener("endJumping", function(){
            $(Jump.element).on("click", dispatchJumpAction);
        });
    });

    actionClicked.add(function(data){

        if (window.socket){

            $(Run.element).off("click", dispatchRunAction);  
            $(Walk.element).off("click", dispatchWalkAction);  
            $(Idle.element).off("click", dispatchIdleAction);

            socket.publish(localPlayerChannel, data, function(err){
                if (err) console.error(err);
                $(Run.element).on("click", dispatchRunAction);
                $(Walk.element).on("click", dispatchWalkAction);
                $(Idle.element).on("click", dispatchIdleAction);
            });

        } else {

            viewer.contentWindow.localPlayerHandler(data);

        }

    });

    $(Run.element).on("click", dispatchRunAction);
    $(Walk.element).on("click", dispatchWalkAction);
    $(Idle.element).on("click", dispatchIdleAction);
    $(Jump.element).on("click", dispatchJumpAction);

    menuItemClicked.add(function(data){
        if ( window.socket ) 
            socket.publish(localPlayerChannel, data);
        else 
            viewer.contentWindow.localPlayerHandler(data);
    });

    $(Male.element).on("click", function(){
        clearTimeout(interval);
        interval = setTimeout(function(){
            menuItemClicked.dispatch("/gender/male");
        }, msec);
    });

    $(Female.element).on("click", function(){
        clearTimeout(interval);
        interval = setTimeout(function(){
            menuItemClicked.dispatch("/gender/female");
        }, msec);
    });

    $(Left.element).on("click", function (){
        menuItemClicked.dispatch("/turn/left");
    });

    $(Back.element).on("click", function (){
        menuItemClicked.dispatch("/turn/back");
    });

    $(Right.element).on("click", function (){
        menuItemClicked.dispatch("/turn/right");
    });

    $(Front.element).on("click", function (){
        menuItemClicked.dispatch("/turn/front");
    });

    $(Hairs.element).on("click", function (){
        clearTimeout(interval);
        interval = setTimeout(function(){
            menuItemClicked.dispatch("/outfit/hairs");
        }, msec);
    });

    $(Stockings.element).on("click", function (){
        clearTimeout(interval);
        interval = setTimeout(function(){
            menuItemClicked.dispatch("/outfit/stockings");
        }, msec);
    });

    $(Underwears.element).on("click", function (){
        clearTimeout(interval);
        interval = setTimeout(function(){
            menuItemClicked.dispatch("/outfit/underwears");
        }, msec);
    });

    $(Dress.element).on("click", function (){
        clearTimeout(interval);
        interval = setTimeout(function(){
            menuItemClicked.dispatch("/outfit/dress");
        }, msec);
    });

    $(Costume.element).on("click", function (){
        clearTimeout(interval);
        interval = setTimeout(function(){
            menuItemClicked.dispatch("/outfit/costume");
        }, msec);
    });

    $(Tshirt.element).on("click", function (){
        clearTimeout(interval);
        interval = setTimeout(function(){
            menuItemClicked.dispatch("/outfit/tshirt");
        }, msec);
    });

    $(Trousers.element).on("click", function (){
        clearTimeout(interval);
        interval = setTimeout(function(){
            menuItemClicked.dispatch("/outfit/trousers");
        }, msec);
    });

    $(Shoes.element).on("click", function (){
        clearTimeout(interval);
        interval = setTimeout(function(){
            menuItemClicked.dispatch("/outfit/shoes");
        }, msec);
    });

})();

</script>

<script>

    $("#login-tab").load("/login-tab/");
    $("#control-tab").load("/control-tab/");

</script>


</body>
</html>

